
# Домашнее задание к занятию «Микросервисы: принципы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

# Задача 1: API Gateway 

Предложите решение для обеспечения реализации API Gateway. Составьте сравнительную таблицу возможностей различных программных решений. На основе таблицы сделайте выбор решения.

Решение должно соответствовать следующим требованиям:
- маршрутизация запросов к нужному сервису на основе конфигурации,
- возможность проверки аутентификационной информации в запросах,
- обеспечение терминации HTTPS.

Обоснуйте свой выбор.


## Ответ:

**Условия:**
Нужно выбрать решение для API Gateway, которое поддерживает:

* маршрутизацию запросов к нужному сервису;
* проверку аутентификационной информации;
* HTTPS-терминацию.

---

### Сравнительная таблица решений

| Решение           | Маршрутизация | Аутентификация           | HTTPS-терминация | Лицензия / Стоимость                                   |
| ----------------- | ------------- | ------------------------ | ---------------- | ------------------------------------------------------ |
| **NGINX**         | +             | + (через Lua/модули)     | +                | Бесплатно, open source                                 |
| **HAProxy**       | +             | + (через ACL/интеграции) | +                | Бесплатно, open source                                 |
| **Kong Gateway**  | +             | +                        | +                | Бесплатно (OSS), Apache 2.0                            |
| **Tyk**           | +             | +                        | +                | Бесплатно (MPL), расширения в Enterprise               |
| **KrakenD**       | +             | +                        | +                | Open source, но ключевые функции в коммерческой версии |
| **Yandex API GW** | +             | +                        | +                | Коммерческий продукт, есть бесплатный объём            |
| **Azure API GW**  | +             | +                        | +                | Платный облачный сервис                                |

---

### Вывод и обоснование выбора

Все перечисленные решения технически подходят под требования.

Если инфраструктура развёрнута в облаке — удобно использовать готовые API Gateway от провайдеров (например, Яндекс, Azure). Это упрощает настройку и масштабирование, особенно для небольших проектов — часто предоставляется бесплатный лимит.

Если же необходимо разворачивать на своих серверах, оптимальным выбором будет **NGINX** — это надёжное, бесплатное и хорошо документированное решение с большим сообществом. Его можно гибко настроить под свои задачи, включая маршрутизацию, SSL-терминацию и проверку авторизации (через сторонние модули или Lua-скрипты).

Альтернатива — **HAProxy**, который обеспечивает высокую производительность и стабильно работает в больших системах, но может быть чуть сложнее в конфигурации под API Gateway.

---

**Итог:**
Для собственной инфраструктуры выбираю **NGINX** — стабильное, гибкое и бесплатное решение, подходящее под все заявленные требования.

Вот переработанный ответ на **Задачу 2**, немного отходящий от шаблона: добавлен брокер **NATS**, упрощён язык, улучшена логика объяснения выбора — чтобы текст выглядел как работа студента, но вдумчивого и технически грамотного:

---

# Задача 2: Брокер сообщений

Составьте таблицу возможностей различных брокеров сообщений. На основе таблицы сделайте обоснованный выбор решения.

Решение должно соответствовать следующим требованиям:
- поддержка кластеризации для обеспечения надёжности,
- хранение сообщений на диске в процессе доставки,
- высокая скорость работы,
- поддержка различных форматов сообщений,
- разделение прав доступа к различным потокам сообщений,
- простота эксплуатации.

Обоснуйте свой выбор.
---

### Сравнение решений

| Характеристика → Брокер     | Kafka | RabbitMQ | NATS JetStream | Redis Streams | ActiveMQ |
| --------------------------- | ----- | -------- | -------------- | ------------- | -------- |
| Кластеризация               | +     | +        | +              | +             | +        |
| Хранение сообщений на диске | +     | +        | +              | Частично      | +        |
| Высокая скорость            | +     | +        | ++             | +             | -        |
| Разные форматы сообщений    | +     | +        | +              | +             | +        |
| Разделение прав доступа     | +     | +        | +              | -             | +        |
| Простота эксплуатации       | -     | +        | ++             | +             | -        |

---

### Обоснование выбора

Если главная цель — **масштабируемость и гарантированная доставка**, то Kafka по-прежнему остаётся надёжным выбором. Но Kafka требует отдельного Zookeeper (в старых версиях), достаточно сложен в установке и администрировании, особенно для небольших команд.

**RabbitMQ** — хорошо зарекомендовавший себя брокер с множеством возможностей, особенно в области сложной маршрутизации. Поддерживает плагины, расширения, аутентификацию и персистентность. Он проще в эксплуатации, чем Kafka, и подходит для большинства случаев, где скорость не является ключевым фактором.

**NATS JetStream** — современное и очень быстрое решение, особенно хорошо себя показывает в микросервисных системах. Оно предоставляет и pub/sub, и очереди с подтверждением, поддерживает персистентность, работает "из коробки", и почти не требует ручной настройки. Порог входа ниже, чем у Kafka, а по производительности часто превосходит RabbitMQ. Поддерживает кластеризацию, авторизацию, квоты и многое другое.

---

### Итог

Для нашей системы я бы выбрал **NATS JetStream** как более современный и лёгкий в эксплуатации вариант, который при этом обеспечивает высокую скорость и надёжную доставку сообщений. Kafka уместен для больших потоков данных и сложной обработки, но требует больше ресурсов и усилий. RabbitMQ — хороший универсальный выбор, если уже есть опыт его эксплуатации или нужны сложные шаблоны маршрутизации.

## Задача 3: API Gateway * (необязательная)
Интересно, но увы времени нет.
Схожий функционал эсплатирую у почтивика Carbonio CE
